# Network

## **OSI-7 계층 (OSI-7 Layer)**

1. **OSI 7계층이란?** </br>
 OSI 7계층은 네트워크에서 통신이 일어나는 과정을 7단계로 나눈 것을 말한다.
  
1. **OSI 7 계층을 나눈이유는?** </br>
    계층을 나눈 이유는 통신이 일어나는 과정이 단계별로 파악할 수 있기 때문이다.<br>

## **OSI 7 계층의 장점?**
  - 흐름을 한눈에 알아보기 쉽다
  - 사람들이 이해하기 쉽다
  - **7단계 중 특정한 곳에 이상이 생기면 다른 단계의 장비 및 소프트웨어를 건들이지 않고도 이상이 생긴 단계만 고칠 수 있기 때문이다.** <br>
    (소프트웨어, 하드웨어에 독립적인 단위로 네트워크 구성을 했음을 의미)
  - 상위 계층의 프로토콜이 제대로 동작하기 위해서는 하위의 모든 계층에 문제가 없어야한다.
      - 예를들어,  인터넷이 안될때  ping을 쏴서 확인해볼때, ping이 잘수행되고 문제가 없다면 1계층부터 3계층 즉 네트워크 계층까지는 모두 이상이 없다는 얘기다.
## **OSI 7 계층 단계**
![계층별이미지](https://t1.daumcdn.net/cfile/tistory/995EFF355B74179035)
<br>

## 1계층-물리 계층 (Physical Layer) 
- 이 계층에서는 주로 전기적, 기계적인 특성을 이용해서 통신 케이블로 데이터를 전송하게 된다. 
- 이 계층에서 사용되는 통신 단위는 비트이며 이것은 1과 0으로 나타내어지는, 즉 전기적으로 On, Off 상태라고 생각하면 된다. <br>
- 이 계층에서는 데이터를 전달만 할뿐 전송하려는 (또는 받으려는) **데이터가 무엇인지, 어떤 에러가 있는지 등에는 전혀 신경 쓰지 않는다.**<br>
- 단지 데이터 전기적인 신호로 변환해서 주고받는 기능만 할 뿐이다. 이 계층에 속하는 대표적인 장비는 **통신 케이블, 리피터, 허브**등이 있다.




## 2계층-데이터 링크 계층 (DataLink Layer) 
물리계층을 통해 송수신되는 정보의 오류와 흐름을 관리하여 안전한 정보의 전달을 수행할 수 있도록 도와주는 역할을 한다. (**오류 관리, 흐름 관리 추가 필요**)

* 데이터 링크 계층이 제공하는 서비스 3가지 
  * 프레이밍
  * 흐름제어
  * 에러제어

- 오류찾기, 재전송 기능
- 맥주소를 가지고 통신
- 이 계층에서 전송되는 단위를 **프레임(Frame)** 이라고 하고, 대표적인 장비로는 브리지, 스위치 등이 있다(여기서 맥주소 사용)
- 주소값은 물리적으로 할당받음. (네트워크 카드가 만들어질 때부터 맥 주소(MAC address)가 정해져 있다는 뜻이다. )
- 주소 체계는 계층이 없는 단일 구조이다 
- 데이터 링크 계층의 가장 잘 알려진 예는 이더넷 <br>
- 핵심 : **포인트 투 포인트(Point to Point) 간 신뢰성있는 전송을 보장하기 위한 계층**
- 키워드 : **에러검출/재전송/흐름제어**

>  **프레이밍 이란 ?**
>
> 데이터 배열에 Data Header, Trailer 등을 넣어서 캠슐화(Encapsulate)를 하는 작업을 말한다. 




## 3계층-네트워크 계층(Network Layer) 
- 데이터를 목적지까지 가장 안전하고 빠르게 전달하는 기능(**라우팅**)
- 3계층의 전송단위는 패킷(Packet)이며, 패킷을 목적지 까지 경로 설정을 한다.
- 여기에 사용되는 프로토콜의 종류도 다양하고, 라우팅하는 기술도 다양하다
- 대표적인 장비는 **라우터**
- 여러개의 노드를 거칠때마다 경로를 찾아주는 역할을 하는 계층
- 라우팅, 흐름 제어, 세그멘테이션(segmentation/desegmentation), 오류 제어, 인터네트워킹(Internetworking)
- 키워드 : **주소부여(IP), 경로설정(Route)**

### IP 계층
- 네트워크의 주소 (IP 주소)를 정의하고,  IP 패킷의 전달 및 라우팅을 담당하는 계층
- OSI 7계층모델의 관점에서 보면  IP 계층은 네트워크계층에 해당
- 패킷을 목적지까지 전달하는 역할 및 그에 수반되는 기타 역할을 함
- **IP 계층에서는 그 하위계층인 데이터링크 계층의 하드웨어적인 특성에 관계없이 독립적인 역할을 수행**

### IP 프로토콜
- IP의 정보는 패킷 혹은 데이터그램이라고 하는 덩어리로 나뉘어 전송된다. 
- IP에서는 이전에 통신한 적 없는 호스트에 패킷을 보낼 때 경로 설정이 필요없다. (이유는??)
- IP는 비신뢰성(unreliability)과 비연결성(connectionlessness)이 특징이다
- IP 헤더 내 바이트 전달 순서 : 최상위 바이트(MSB)를 먼저 보냄  ☞ Big-endian 
- 패킷 전송과 정확한 순서를 보장하려면 TCP 프로토콜과 같은 IP의 상위 프로토콜을 이용
- 현재 인터넷에서 사용하는 표준 프로토콜은 인터넷 프로토콜의 4번째 판인 IPv4이다.
- 그러나 IPv4는 주소공간 고갈 문제를 겪고 있어 조만간 6번째 판인 IPv6가 대중화될 것으로 보인다



## 4계층-전송 계층(Transport Layer)
종단간(End-to-End)에 신뢰성 있고 정확한 데이터 전송을 담당한다.

- 4계층에서 전송단위는 세그먼트(Segment)이며, 종단 간의 에러복구와 흐름제어를 담당한다.
- 통신을 활성화하기 위한 계층
- 보통 TCP프로토콜을 이용하며, 포트를 열어서 응용프로그램들이 전송을 할 수 있게 한다
- 만약 데이터가 왔다면 4계층에서 해당 데이터를 하나로 합쳐서 5계층에 던져 준다
- 단대단 오류제어 및 흐름제어 이 계층 까지는 물리적인 계층에 속한다.(TCP/UDP프로토콜을 사용한다.)
-  양 끝단(End to end)의 사용자들이 신뢰성있는 데이터를 주고 받을 수 있도록 해 주어, 상위 계층들이 데이터 전달의 유효성이나 효율성을 생각하지 않도록 해준다. 
- 연결 기반(connection oriented)이다. (전송 계층이 패킷들의 전송이 유효한지 확인하고 전송 실패한 패킷들을 다시 전송한다는 것을 뜻한다)

### **TCP vs UDP**
- TCP 
  - 1. 신뢰성 있음 (Reliable), 
  - 2. 연결지향적 (Connection-oriented) 
- UDP 
  - 1. 신뢰가 없음, 
  - 2. 비연결성 (순서제어 X, 오류제어 X, 흐름제어 X)

UDP의 장점?? 실시간 응용 및 멀티캐스팅 가능 (빠른 요청과 응답), 헤더가 단순함 (처리 노력이 줄음)



## 5계층-세션 계층(Session Layer) 
통신장치 간 상호작용 및 동기화를 제공한다.

- 데이터가 통신하기 위한 논리적인 연결

- 세션 계층(Session layer)은 양 끝단의 응용 프로세스가 통신을 관리하기 위한 방법을 제공한다.

- 동시 송수신 방식(duplex), 반이중 방식(half-duplex), 전이중 방식(Full Duplex)의 통신과 함께, 체크 포인팅과 유휴, 종료, 다시 시작 과정 등을 수행한다

  > 전이중 방식(Full-duplex) : 두개의 통신장치가 동시에 통신이 가능한 통신 방식
  >
  > 반이중 방식(Half-duplex) : 두개의 통신장치 중 하나만 통신이 가능한 통신 방식

- 이 계층은 TCP/IP 세션을 만들고 없애는 책임을 진다.

## 6계층-표현 계층(Presentation Layer)
데이터 표현에 차이가 있는 응용처리에서의 제어 구조를 제공한다.

여기서 데이터 표현의 차이란 : ASCII, JPEG, MPEG 등의 번역을 의미한다.

- 코드 간의 번역을 담당
- 사용자 시스템에서 데이터의 형식상 차이를 다루는 부담을 응용 계층으로부터 덜어 준다.
- 인코딩이나 암호화 등 수행

## 7계층 - 응용 계층(Application Layer)
사용자와 가장 밀접한 계층으로, 인터페이스(Interface)역할을 한다. 응용프로세스간의 정보교환을 수행한다.

- 최종 목적지로서 HTTP, FTP, SMTP, POP3, IMAP, Telnet 등과 같은 프로토콜이 있다. 
- 해당 통신 패킷들은 방금 나열한 프로토콜에 의해 모두 처리되며 우리가 사용하는 브라우저나, 메일 프로그램은 프로토콜을 보다 쉽게 사용하게 해주는 응용프로그램이다.
- 한마디로 모든 통신의 양 끝단은 HTTP와 같은 프로토콜이지 응용프로그램이 아니다.
- 응용 계층(Application layer)은 응용 프로세스와 직접 관계하여 일반적인 응용 서비스를 수행한다.

  --> HTTP 프로토콜(HyperText Transfer Protocol)

- 웹 상에서 웹 서버 및 웹브라우저 상호 간의 데이터 전송을 위한 응용계층 프로토콜
- 처음에는, WWW 상의 하이퍼텍스트 형태의 문서를 전달하는데 주로 이용
- 현재에는, 이미지,비디오,음성 등 거의 모든 형식의 데이터 전송 가능

### 추가 : 흐름제어 vs 혼잡제어 vs 오류제어
#### 흐름제어
- 흐름제어는 수신측과 송신측의 데이터처리 속도차이를 해결하기 위한 기법이다. (송신과 수신)

- 만약 송신측의 전송량 > 수신측의 처리량 일 경우, 전송된 패킷은 수신측의 큐를 넘어서 손실될 수 있기 때문에 송신측의 패킷 전송량을 제어하게 된다. 

- 기법 : 정지-대기(Stop-and-wait), 슬라이딩 윈도우(Sliding Window)

  > **정지-대기** : 매번 전송한 패킷에 대해 응답을 받아야만 그 다음 패킷을 전송 가능, 간단함, **비효율적**
  >
  > **슬라이딩 윈도우** : 수신측에서 설정한 윈도우 크기만큼 송신측에서 확인 응답 없이 세그먼트를 전송하여 데이터 흐름을 동적으로 조절

#### 혼잡제어
- 혼잡 제어는 송신측과 네트워크의 데이터처리 속도 차이를 해결하기 위한 기법이다. (송신과 라우터)

- 송신된 패킷이 네트워크 상의 라우터가 처리할 수 있는 양을 넘어서 혼잡하게 되면 데이터가 손실될 수 있기 때문에 송신측의 전송량을 제어하게 된다.

- 기법 : AIMD, 슬로우 스타트(Slow Start) 

  > **AIMD** : 패킷을 보내고 문제없으면 크기를 1씩 증가시키면서 전송, 실패나 일정 시간을 넘으면 전송속도를 반으로 줄임, **공평한 방식**, 초기에 높은 대역폭을 사용하지 못하는 문제, **혼잡을 미리 감지 못함**
  >
  > **슬로우 스타트** :  패킷이 문제없이 도착하면 각각의 ACK 패킷마다 size를 1씩 늘린다. 즉, 한 주기가 지나면 window size가 2배가 된다. 혼잡 현상이 발생시 Window Size를 1로 떨어트림, **지수 증가**, 임계 값에 도달 시 **혼잡 회피** 단계로 넘어감
  >
  > 그외에도 추가적으로 빠른 회복, 빠른 재전송, TCP Reno, TCP Tahoe 등이 있다. [관련 출처](https://woovictory.github.io/2018/12/28/Network-Erro-Flow-Control/)
#### 오류제어
- 오류검출(error detection)과 재전송(retransmisstion)

- ARQ(Automatic Repeat Request) : 신뢰성 있는 데이터 전달을 위해 재전송을 기반으로 한 에러 제어 방식

- 기법 : 정지-대기 ARQ, Go-Back-n ARQ

  > **정지 대기 ARQ** : 전송측은 수신측에서 보내준 ACK를 받을 때까지 복사본을 유지, 못받으면 NAK를 보낸다. ACK가 분실되었을 때 일정 시간을 두고 **타임 아웃**으로 확인하고 송신측에서 재전송함
  >
  > **Go-Back-n ARQ** : 전송된 프레임이 손실되거나 분실될 경우, **확인된 마지막 프레임 이후로 모두 재전송**

### 참고
https://goodgid.github.io/Error-Flow-Control/ <br>
https://shlee0882.tistory.com/110
https://woovictory.github.io/2018/12/28/Network-Erro-Flow-Control/
http://blog.naver.com/PostView.nhn?blogId=demonicws&logNo=40117378644
