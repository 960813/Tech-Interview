## 메모리 구조

### 메모리 구조

프로그램이 실행되기 위해서는 먼저 프로그램이 메모리에 로드(load)되어야 한다. 또한, 프로그램에서 사용되는 변수들을 저장할 메모리도 필요하다.

따라서 컴퓨터의 운영체제는 프로그램의 실행을 위해 다양한 메모리 공간을 제공하고 있다. 프로그램이 운영체제로부터 할당받는 대표적인 메모리 공간은 다음과 같다.

1. 코드(code) 영역
2. 데이터(data) 영역
3. 스택(stack) 영역
4. 힙(heap) 영역

다음 그림은 운영체제가 제공하는 메모리 공간을 표현한다.

![메모리 구조](http://tcpschool.com/lectures/img_c_memory_structure.png)



### 코드(code) 영역

메모리의 코드(code)영역은 실행할 프로그램의 코드가 저장되는 영역으로 **텍스트(code) 영역**이라고도 부른다. CPU는 코드 영역에 저장된 명령어를 하나씩 가져가서 처리하게 된다.

CPU는 코드 영역에 저장된 명령어를 하나씩 가져가서 처리하게 된다.

특징을 정리하자면 다음과 같다

* 힙과 스택영역에서 오버플로우가 발생할 것을 대비해서 힙/스택의 아래부분에 위치한다.
* 실행 인스트럭션 등이 저장되어 있다
* 읽기 전용
* 다른 프로세스에서 참조 가능한 영역

### 데이터(data) 영역

메모리의 데이터(data) 영역은 프로그램의 **전역 변수**와 **정적(static) 지역 변수**가 저장되는 영역입니다.

데이터 영역은 프로그램의 시작과 함께 할당되며 프로그램이 종료되면 소멸한다.

좀 더 정리하자면 다음과 같다

* 데이터 영역에는 전역 변수와 정적 지역 변수가 포함되어 있다.
* 데이터 영역은 BSS와 Data로 나누어진다.
  * BSS는 초기화 되지 않은 변수들이 저장
  * Data는 초기화된 변수들이 저장
* BSS, Data로 구분하는 이유는 다음과 같다
  * 초기화 된 데이터는 초기값을 저장해야 함으로 Data 영역에 저장되어 Rom에 저장된다. 하지만 초기화 되지 않은 데이터까지 Rom에 저장되면 큰 size의 Rom이 필요하므로 구분한다.(초기화 되지 않은 데이터는 Ram에 저장)

### 힙 영역

메모리의 힙(heap) 영역은 사용자가 직접 관리할 수 있는 '그리고 해야만 하는' 메모리 영역이다.

힙  영역은 사용자에 의해 메모리 공간이 동적으로 할당되고 해제된다. 즉 프로그램이 실행되는 동안 동적으로 사용할 데이터가 저장된다.

힙 영역은 메모리의 낮은 주소에서 높은 주소의 방향으로 할당된다.

예를 들어, c언어의 malloc을 이용해서 메모리를 동적할당하면 힙 영역에 저장되고 free를 시키지 않는다면 계속 힙 영역에 들어가 있다.

### 스택 영역

메모리의 스택(stack) 영역은 함수의 호출과 관계되는 지역 변수와 매개변수가 저장되는 영역입니다.

* 스택 영역은 프로그램의 지역변수, 함수, reture address 를 포함
* 아래의 함수는 호출시 스택영역에 저장되어 있다가 return을 하게 되면 스택에서 pop을 하게 된다.

```c++
int function(int a){
  return a+1;
}
```



스택 영역은 함수의 호출과 함게 할당되며, 함수의 호출이 완료되면 소멸한다.

이렇게 스택 영역에 저장되는 함수의 호출 정보를 **스택 프레임(stack frame)**이라고 한다.

스택 영역은 푸시(push) 동작으로 데이터를 저장하고 팝(pop) 동작으로 데이터를 인출한다. 이러한 스택은 후입선출(LIFO, Last-In First0-Out) 방식에 따라 동작하므로, 가장 늦게 저장된 데이터가 가장 먼저 인출된다

스택 영역은 메모리의 높은 주소에서 낮은 주소의 방향으로 할당된다.

