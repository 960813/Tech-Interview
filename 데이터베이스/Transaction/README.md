# 트랜잭션

데이터베이스의 상태를 변환시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위 또는 한꺼번에 모두 수행되어야 할 일련의 연산들을 의미.



## 트랜잭션의 특징

1. 트랜잭션은 데이터 베이스 시스템에서 병행제어 및 회복 작업 시 처리되는 **작업의 논리적인 단위** 이다.
2. 사용자가 시스템에 대한 서비스 요구 시 시스템이 응답하기 위한 상태 변환 과정의 작업단위 이다.
3. 하나의 트랜잭션은 Commit되거나 Rollback된다.



## 트랜잭션의 성질

**Atomicity(원자성)**

1. 트랜잭션의 연산은 데이터베이스에 모두 반영되든지 아니면 전혀 반영되지 않아야 한다.

2. 트랜잭션 내의 모든 명령은 반드시 완벽히 수행되어야 하며, 모두가 완벽히 수행되지 않고 어느하나라도 오류가 발생하면 트랜잭션 전부가 취소되어야 한다.



**Consistency(일관성)**

1. 트랜잭션이 그 실행을 성공적으로 완료하면 언제나 **일관성 있는 데이터베이스 상태로 변환** 한다.
   * 여기서 일관성이 있어야 한다는 것은 트랜잭션의 작업 처리결과가 일관성이 있어야 한다는 것.

2. 시스템이 가지고 있는 고정요소는 트랜잭션 수행 전과 트랜잭션 수행 완료 후의 상태가 같아야 한다.

> 일관성이 이해 되지 않아서 좀 찾아 보았는데
>
> 트랜잭션이 진행되는 동안에 데이터베이스가 변경되더라도 업데이트된 데이터베이스로 트랜잭션이 진행되는 것이 아니라, **처음에 트래잭션을 진행 하기 위해 참조한 데이터 베이스로 진행** 한다. 이렇게 함으로써 각 사용자는 일관성 있는 데이터를 볼수가 있다. 

**Isolation(독립성,격리성)**

1. 둘 이상의 트랜잭션이 동시에 병행 실행되는 경우 어느 하나의 트랜잭션 실행중에 다른 트랜잭션의 연산이 끼어들 수 없다.

2. 수행중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 수행 결과를 참조할 수 없다.



**Durablility(영속성,지속성)**

1. 성공적으로 완료된 트랜잭션의 결과는 시스템이 고장나더라도 영구적으로 반영되어야 한다.



## 트랜잭션의 Commit, Rollback

### Commit 

* 하나의 트랜잭션이 성공적으로 끝났고, 데이터베이스가 일관성 있는 상태에 있을때 하나의 트랜잭션이 끝났다라는 것을 알려주기 위해 사용되는 연산.

### Rollback

* 하나의 트랜잭션 처리가 비정상적으로 종료되어 데이터베이스의 일관성을 깨뜨렸을때, 이 트랜잭션의 일부가 정상적으로 처리 되었더라도 트랜잭션의 원자성을 구현하기 위해 이 트랜잭션이 행한 모든 연산을 취소하는 연산이다.
* Rollback시에는 해당 트랜잭션을 재시작하거나 폐기한다.



## Spring에서의 트랜잭션 - @Transactional

스프링에서도 트랜잭션 처리를 지원하는데 그중 **어노테이션 방식** 으로 @Transactional을 선언하여 사용하는 방법이 일반적이며, 선언적 트랜잭션이라 부른다.

클래스, 메서드 위에 @Transactional 이 추가되면, 이 클래스에 트랜잭션 기능이 적용된 프록시 객체가 생성된다.

이 프록시 객체는 @Transactional이 포함된 메소드가 호출 될 경우, PlatformTranactionManager를 사용하여 트랜잭션을 시작하고, 정상 여부에 따라 Commit 또는 Rollback 한다.





### Reference

* https://coding-factory.tistory.com/226
* https://mommoo.tistory.com/62
* https://goddaehee.tistory.com/167